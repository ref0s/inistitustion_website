# Institution Management System

## المتطلبات
- Node.js 18+
- npm

## تثبيت المشروع وتشغيله (Windows / macOS / Linux)

### 1) المتطلبات
- Node.js 18+ (على Windows استخدم Node.js الرسمي أو nvm-windows)
- npm

### 2) تثبيت الحزم
```bash
# في جذر المستودع
cd server && npm install
cd ../client && npm install
```

### 3) تهيئة قاعدة البيانات (SQLite)
من مجلد `server`:
```bash
node migrations/init.js
```
> يقوم بإسقاط الجداول الحالية، إنشاء المخطط الجديد، وإدخال بيانات تجريبية (أقسام، طلاب، مواد، فصل تجريبي، جدول حصص).

### 4) تشغيل الخادم (Backend)
من مجلد `server`:
```bash
npm start
```
افتراضيًا يستخدم المنفذ `5050`. غيّر المتغيرات حسب الحاجة:
- `PORT` (الافتراضي 5050)
- `SQLITE_FILE` (مسار قاعدة البيانات؛ افتراضي `./data/app.db`)

الخادم محمي بـ Basic Auth ثابتة: اسم المستخدم `admin` وكلمة المرور `admin`.

### 5) تشغيل الواجهة (Frontend)
من مجلد `client`:
```bash
npm run dev
```
اضبط `VITE_API_URL` في `.env` داخل `client` إذا غيّرت منفذ أو مضيف الخادم (الافتراضي `http://localhost:5050`).

### 6) الاختبارات
الخادم (Jest + supertest):
```bash
cd server
npm test
```
الواجهة:
```bash
cd client
npm run build
```
> على Windows نفّذ الأوامر في PowerShell أو Git Bash؛ لا توجد أوامر خاصة بـ Unix في الخطوات أعلاه.

## الاختبارات
تشغيل اختبارات الخادم (Jest + supertest):
```bash
cd server
npm test
```

## ما المتوفر في البيانات الأولية؟
- فترات زمنية ثابتة (3 فترات) قابلة لتعديل الوقت/العنوان.
- فصل تجريبي واحد (Spring 2025) مع بعض المواد والطلاب المسجلين، وجدول مبدئي.
- أقسام تجريبية (`GEN`, `CS`, `SE`) مع ربط المواد والطلاب بها.

## ملاحظات سريعة
- كل واجهات الإدارة محمية بـ Basic Auth فقط.
- عمليات التسجيل الجماعي والتخصيصات تتم داخل معاملات وتتعامل مع التكرار بشكل آمن (idempotent).
- جدول الحصص يمنع تكرار المادة نفسها في نفس اليوم والفترة داخل الفصل.
- الطالب يجب أن ينتمي لقسم واحد، والمادة يجب أن ترتبط بقسم واحد على الأقل.
- إسناد مادة لطالب في فصل ما يتطلب: تسجيل الطالب في الفصل، عرض المادة في الفصل، وأن تكون المادة مرتبطة بقسم الطالب.
